namespace = distar

ship_event = {
	id = distar.170
	title = "distar.170.name"
	desc = {
		trigger = {
			owner = {
				NOT = { has_authority = auth_machine_intelligence }
			}
		}
		text = "distar.170.desc"
	}
	desc = {
		trigger = {
			owner = {
				has_authority = auth_machine_intelligence
			}
		}
		text = "distar.170.desc.machi"
	}
	picture = GFX_evt_alien_nature
	show_sound = event_alien_nature
	location = from
	
	is_triggered_only = yes

	option = {
		trigger = {
			owner = {
				NOT = { has_authority = auth_machine_intelligence }
				any_owned_pop = {
					species = {
						NOR = {
							#has_trait = trait_cybernetic					####
							has_trait = trait_mechanical
							has_trait = trait_machine_unit
						}
					}
				}
			}
		}
		name = "distar.170.a"
		from = {
			enable_special_project = {
				name = "BRAINSLUG_PROJECT"
				location = this
				owner = root.owner
			}
		}
	}

	option = {
		trigger = {
			owner = {
				NOT = { has_authority = auth_machine_intelligence }
			}
		}
		name = NOTIME
	}

	option = {
		trigger = {
			owner = {
				has_authority = auth_machine_intelligence
			}
		}
		name = "distar.170.machi"
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier4researchreward
				min = @tier4researchmin
				max = @tier4researchmax
			}
		}
	}
}

ship_event = {
	id = distar.171
	title = "distar.171.name"
	desc = "distar.171.desc"
	picture = GFX_evt_society_research
	show_sound = event_alien_nature
	location = from
	
	is_triggered_only = yes

	immediate = {
		leader = {
			save_event_target_as = brainslug_scientist
		}
	}

	option = {
		name = "distar.171.a"
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier4researchreward
				min = @tier4researchmin
				max = @tier4researchmax
			}
		}
	}

	option = {
		name = "distar.171.b"
		hidden_effect = {
			ship_event = { id = distar.172 days = 30 }
		}
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier4researchreward
				min = @tier4researchmin
				max = @tier4researchmax
			}
		}
	}
}

ship_event = {
	id = distar.172
	title = "distar.172.name"
	desc = "distar.172.desc"
	picture = GFX_evt_hive_mind
	show_sound = event_alien_nature
	location = root
	
	is_triggered_only = yes

	trigger = {
		exists = event_target:brainslug_scientist
	}

	immediate = {
		leader = {
			add_trait = leader_trait_scientist_brainslug
		}
		owner = {
			set_country_flag = finished_brainslug_chain
		}
	}

	option = {
		trigger = {
			owner = {
				NOR = {
					has_ethic = ethic_xenophobe
					has_ethic = ethic_fanatic_xenophobe
				}
			}
		}
		name = "distar.172.a"
		owner = {
			add_research_option = tech_tahaByKerhus_brainslug1
			add_tech_progress = {
				tech = tech_tahaByKerhus_brainslug1
				progress = 0.30
			}
			while = {
				count = 3
				random_owned_pop = {
					limit = {
						is_sapient = yes
						species = {
							NOR = {
								#has_trait = trait_cybernetic				####
								has_trait = trait_mechanical
								has_trait = trait_machine_unit
								is_species_class = ROBOT
							}
						}
					}
					modify_species = {
						species = this
						add_trait = trait_brainslug
						add_traits_at_start_of_list = yes
						hidden_effect = {
							set_citizenship_type = {
								country = root.owner
								type = citizenship_full
								cooldown = no
							}
						}
					}
				}
			}
			hidden_effect = {
				while = {
					count = 2
					random_owned_leader = {
						LIMIT = {
							leader_class = scientist
							species = {
								NOR = {
									#has_trait = trait_cybernetic			####
									has_trait = trait_mechanical
									has_trait = trait_machine_unit
									is_species_class = ROBOT
								}
							}
						}
						add_trait = leader_trait_scientist_brainslug
					}
				}
				random_owned_leader = {
					LIMIT = {
						leader_class = governor
						species = {
							NOR = {
								#has_trait = trait_cybernetic				####
								has_trait = trait_mechanical
								has_trait = trait_machine_unit
								is_species_class = ROBOT
							}
						}
					}
					add_trait = leader_trait_governor_brainslug
				}
				country_event = { id = distar.174 } #Pool leaders get trait
				country_event = { id = distar.175 } #Unrest is generated
			}
		}
	}

	option = {
		trigger = { # at least one sluggable pop in xenophobe empire
			hidden_trigger = {
				owner = {
					OR = {
						has_ethic = ethic_xenophobe
						has_ethic = ethic_fanatic_xenophobe
					}
					any_owned_pop = {
						NOR = {
							has_ethic = ethic_xenophobe
							has_ethic = ethic_fanatic_xenophobe
						}
					}
				}
			}
		}
		name = "distar.172.a"
		owner = {
			add_research_option = tech_tahaByKerhus_brainslug1
			add_tech_progress = {
				tech = tech_tahaByKerhus_brainslug1
				progress = 0.30
			}
			while = { # slug *up to* three non-phobe pops
				count = 3
				random_owned_pop = {
					LIMIT = {
						NOR = {
							has_ethic = ethic_xenophobe
							has_ethic = ethic_fanatic_xenophobe
						}
						species = {
							NOR = {
								#has_trait = trait_cybernetic				####
								has_trait = trait_mechanical
								has_trait = trait_machine_unit
								is_species_class = ROBOT
							}
						}
						is_sapient = yes
					}
					modify_species = {
						species = this
						add_trait = trait_brainslug
						add_traits_at_start_of_list = yes
						hidden_effect = {
							set_citizenship_type = {
								country = root.owner
								type = citizenship_full
								cooldown = no
							}
						}
					}
				}
			}
			hidden_effect = {
				country_event = { id = distar.174 } #Pool leaders get trait
				country_event = { id = distar.175 } #Unrest is generated
			}
		}
	}

	option = {
		name = "distar.172.b"
		custom_tooltip = "distar.172.b.tooltip"
	}
}

country_event = { #New leaders get Brainslug Trait
	id = distar.173
	hide_window = yes
	
	is_triggered_only = yes

	trigger = {
		has_country_flag = finished_brainslug_chain
		from.species = {
			NOR = {
				#has_trait = trait_cybernetic								####
				has_trait = trait_mechanical
				has_trait = trait_machine_unit
				is_species_class = ROBOT
			}
		}
	}

	immediate = {
		from = {
			if = {
				limit = {
					leader_class = general
					species = {
						NOR = {
							#has_trait = trait_cybernetic					####
							has_trait = trait_mechanical
							has_trait = trait_machine_unit
							is_species_class = ROBOT
						}
					}
				}
				add_trait = leader_trait_general_brainslug
				add_ruler_trait = leader_trait_ruler_brainslug
				break = yes
			}
			if = {
				limit = {
					leader_class = admiral
					species = {
						NOR = {
							#has_trait = trait_cybernetic					####
							has_trait = trait_mechanical
							has_trait = trait_machine_unit
							is_species_class = ROBOT
						}
					}
				}
				add_trait = leader_trait_admiral_brainslug
				add_ruler_trait = leader_trait_ruler_brainslug
				break = yes
			}
			if = {
				limit = {
					leader_class = governor
					species = {
						NOR = {
							#has_trait = trait_cybernetic					####
							has_trait = trait_mechanical
							has_trait = trait_machine_unit
							is_species_class = ROBOT
						}
					}
				}
				add_trait = leader_trait_governor_brainslug
				add_ruler_trait = leader_trait_ruler_brainslug
				break = yes
			}
			if = {
				limit = {
					leader_class = scientist
					species = {
						NOR = {
							#has_trait = trait_cybernetic					####
							has_trait = trait_mechanical
							has_trait = trait_machine_unit
							is_species_class = ROBOT
						}
					}
				}
				add_trait = leader_trait_scientist_brainslug
				add_ruler_trait = leader_trait_ruler_brainslug
				break = yes
			}
			if = {
				limit = {
					leader_class = ruler
					species = {
						NOR = {
							#has_trait = trait_cybernetic					####
							has_trait = trait_mechanical
							has_trait = trait_machine_unit
							is_species_class = ROBOT
						}
					}
				}
				add_trait = leader_trait_ruler_brainslug
				add_ruler_trait = leader_trait_ruler_brainslug
				break = yes
			}
		}
	}
}

country_event = { #Pool leaders get Brainslug Trait
	id = distar.174
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		every_pool_leader = {
			if = {
				limit = {
					leader_class = general
					NOR = {
						has_trait = leader_trait_general_brainslug
						species = {
							#has_trait = trait_cybernetic					####
							has_trait = trait_mechanical
							has_trait = trait_machine_unit
							is_species_class = ROBOT
						}
					}
				}
				add_trait = leader_trait_general_brainslug
				add_ruler_trait = leader_trait_ruler_brainslug
			}
			if = {
				limit = {
					leader_class = admiral
					NOR = {
						has_trait = leader_trait_admiral_brainslug
						species = {
							#has_trait = trait_cybernetic					####
							has_trait = trait_mechanical
							has_trait = trait_machine_unit
							is_species_class = ROBOT
						}
					}
				}
				add_trait = leader_trait_admiral_brainslug
				add_ruler_trait = leader_trait_ruler_brainslug
			}
			if = {
				limit = {
					leader_class = governor
					NOR = {
						has_trait = leader_trait_governor_brainslug
						species = {
							#has_trait = trait_cybernetic					####
							has_trait = trait_mechanical
							has_trait = trait_machine_unit
							is_species_class = ROBOT
						}
					}
				}
				add_trait = leader_trait_governor_brainslug
				add_ruler_trait = leader_trait_ruler_brainslug
			}
			if = {
				limit = {
					leader_class = scientist
					NOR = {
						has_trait = leader_trait_scientist_brainslug
						species = {
							#has_trait = trait_cybernetic					####
							has_trait = trait_mechanical
							has_trait = trait_machine_unit
							is_species_class = ROBOT
						}
					}
				}
				add_trait = leader_trait_scientist_brainslug
				add_ruler_trait = leader_trait_ruler_brainslug
			}
			if = {
				limit = {
					leader_class = ruler
					NOR = {
						has_trait = leader_trait_ruler_brainslug
						species = {
							#has_trait = trait_cybernetic					####
							has_trait = trait_mechanical
							has_trait = trait_machine_unit
							is_species_class = ROBOT
						}
					}
				}
				add_trait = leader_trait_ruler_brainslug
				add_ruler_trait = leader_trait_ruler_brainslug
			}
		}
	}
}


country_event = { #Cohabitants of Brainslugged pops generate initial Unrest
	id = distar.175
	hide_window = yes
	
	is_triggered_only = yes
	fire_only_once = yes
	

	immediate = {
		IF = {
			LIMIT = {
				NOR = {
					has_ethic = ethic_xenophobe
					has_ethic = ethic_fanatic_xenophobe
				}
			}
			every_owned_planet = {
				limit = {
					OR = {
						any_owned_pop = { has_trait = trait_brainslug }
						leader = {
							has_trait = leader_trait_governor_brainslug
						}
					}
				}
				add_modifier = { modifier = brainslug_woes days = 4000 }
			}
		}
		ELSE_IF = { #Xenophobes result in higher unrest
			LIMIT = {
				OR = {
					has_ethic = ethic_xenophobe
					has_ethic = ethic_fanatic_xenophobe
				}
			}
			every_owned_planet = {
				limit = {
					OR = {
						any_owned_pop = { has_trait = trait_brainslug }
						leader = {
							has_trait = leader_trait_governor_brainslug
						}
					}
				}
				add_modifier = { modifier = brainslug_woes_phobe days = 3000 }
			}
		}
		ELSE = {
			#NOTHING
		}
	}
}