#############
# Resource buildings
#############

building_ministry_production = {
	base_buildtime = @b2_time
	base_cap_amount = 1
	icon = building_production_center

	category = manufacturing
	
	potential = {
		exists = owner
		owner = { is_regular_empire = yes }
		custom_tooltip = {
			text = SECTOR_UNIQUE_BUILDING
			exists = sector
			OR = {
				is_capital = yes
				is_sector_capital = yes
			}
		}
		NOR = {
			has_modifier = resort_colony
			has_modifier = slave_colony
		}
	}
	
	allow = {
		has_major_upgraded_capital = yes
	}
	
	destroy_trigger = {
		exists = owner
		OR = {
			owner = { is_regular_empire = no }
			has_modifier = resort_colony
			has_modifier = slave_colony
			buildings_no_motes = yes
			NOR = {
				is_capital = yes
				is_sector_capital = yes
			}
		}
	}
	
	planet_modifier = {
		job_administrator_add = 1
		planet_metallurgists_produces_mult = 0.05
		planet_artisans_produces_mult = 0.05
	}

	resources = {
		category = planet_buildings
		cost = {
			minerals = @b2_minerals
			volatile_motes = @b2_rare_cost
		}
		upkeep = {
			energy = @b2_upkeep
			volatile_motes = @b2_rare_upkeep
		}
	}
	
	prerequisites = {
		"tech_global_production_strategy"
	}
	
	triggered_desc = {
		text = job_administrator_effect_desc
	}
	triggered_desc = {
		text = building_ministry_production_effect_desc
	}
	
	show_tech_unlock_if = { 
		is_regular_empire = yes
	}
	
	on_built = {
		planet = { 
			owner = { country_event = { id = onactionpops.5 } }
		}
	}
	
	on_destroy = {
		planet = { 
			owner = { country_event = { id = onactionpops.5 } }
		}
	}
	
	ai_weight = {
		weight = 0
		modifier = {
			weight = 10
			owner = {
				any_owned_planet = {
					OR = {
						has_building = building_foundry_1
						has_building = building_foundry_2
						has_building = building_foundry_3

						has_building = building_factory_1
						has_building = building_factory_2
						has_building = building_factory_3
						
						num_districts = { type = district_arcology_arms_industry value > 1 }
						num_districts = { type = district_arcology_civilian_industry value > 1 }
						num_districts = { type = district_hab_foundry value > 1 }
					}
					sector = {
						is_same_value = prev.prev.prev.sector
					}
				}
			}
		}
		modifier = {
			weight = 10
			OR = {
				has_building = building_foundry_1
				has_building = building_foundry_2
				has_building = building_foundry_3

				has_building = building_factory_1
				has_building = building_factory_2
				has_building = building_factory_3
				
				num_districts = { type = district_arcology_arms_industry value > 1 }
				num_districts = { type = district_arcology_civilian_industry value > 1 }
				num_districts = { type = district_hab_foundry value > 1 }
			}
		}
		modifier = {
			weight = 1
			free_building_slots = 0
		}#Repairs
	}
}

building_production_center = {
	base_buildtime = @b2_time
	base_cap_amount = 1

	category = manufacturing
	
	potential = {
		exists = owner
		owner = { is_gestalt = yes }
		custom_tooltip = {
			text = SECTOR_UNIQUE_BUILDING
			exists = sector
			OR = {
				is_capital = yes
				is_sector_capital = yes
			}
		}
	}
	
	allow = {
		has_major_upgraded_capital = yes
	}
	
	destroy_trigger = {
		exists = owner
		OR = {
			owner = { is_gestalt = no }
			buildings_no_motes = yes
			NOR = {
				is_capital = yes
				is_sector_capital = yes
			}
		}
	}

	resources = {
		category = planet_buildings
		cost = {
			minerals = @b2_minerals
			volatile_motes = @b2_rare_cost
		}
		upkeep = {
			energy = @b2_upkeep
			volatile_motes = @b2_rare_upkeep
		}
	}
	
	planet_modifier = {
		planet_metallurgists_produces_mult = 0.05
		planet_artisans_produces_mult = 0.05
	}
	
	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = { is_hive_empire = yes }
		}
		job_alloy_drone_add = 2
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = { is_machine_empire = yes }
		}
		job_fabricator_add = 1
	}
	
	prerequisites = {
		"tech_global_production_strategy"
	}
	
	triggered_desc = {
		trigger = {
			exists = owner
			owner = { is_machine_empire = yes }
		}		
		text = job_fabricator_effect_desc
	}		
	
	triggered_desc = {
		trigger = {
			exists = owner
			owner = { is_hive_empire = yes }
		}	
		text = job_alloy_drone_effect_desc
	}
	triggered_desc = {
		text = building_ministry_production_effect_desc
	}
	
	show_tech_unlock_if = { 
		is_gestalt = yes
	}
	
	on_built = {
		planet = { 
			owner = { country_event = { id = onactionpops.5 } }
		}
	}
	
	on_destroy = {
		planet = { 
			owner = { country_event = { id = onactionpops.5 } }
		}
	}
	
	ai_weight = {
		weight = 0
		modifier = {
			weight = 10
			owner = {
				any_owned_planet = {
					OR = {
						has_building = building_foundry_1
						has_building = building_foundry_2
						has_building = building_foundry_3

						has_building = building_factory_1
						has_building = building_factory_2
						has_building = building_factory_3
						
						num_districts = { type = district_arcology_arms_industry value > 1 }
						num_districts = { type = district_arcology_civilian_industry value > 1 }
						num_districts = { type = district_hab_foundry value > 1 }
					}
					sector = {
						is_same_value = prev.prev.prev.sector
					}
				}
			}
		}
		modifier = {
			weight = 10
			OR = {
				has_building = building_foundry_1
				has_building = building_foundry_2
				has_building = building_foundry_3

				has_building = building_factory_1
				has_building = building_factory_2
				has_building = building_factory_3
				
				num_districts = { type = district_arcology_arms_industry value > 1 }
				num_districts = { type = district_arcology_civilian_industry value > 1 }
				num_districts = { type = district_hab_foundry value > 1 }
			}
		}
		modifier = {
			weight = 1
			free_building_slots = 0
		}#Repairs
	}
}

### new ###
building_foundry_slave = {
	base_buildtime = @b1_time
	base_cap_amount = 1
	category = manufacturing
	icon = building_foundry_1
	
	potential = {
		exists = owner
		has_modifier = slave_colony
		OR = {
			owner = { has_civic = civic_slaver_guilds }
			owner = { has_civic = civic_indentured_assets }
		}
		building_relaxed_basic_income_check = yes
	}
	
	destroy_trigger = {
		exists = owner
		OR = {
			NOT = { has_modifier = slave_colony }
			owner = {
				NOR = {
					owner = { has_civic = civic_slaver_guilds }
					owner = { has_civic = civic_indentured_assets }
				}
			}
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = { is_hive_empire = yes }
		}
		modifier = {
			job_alloy_drone_add = @b2_jobs
		}
	}
	
	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = { is_machine_empire = yes }
		}
		modifier = {
			job_fabricator_add = @b2_jobs
		}
	}
	
	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = { is_regular_empire = yes }
		}
		modifier = {
			job_foundry_add = @b2_jobs
		}
	}
	
	resources = {
		category = planet_buildings
		cost = {
			minerals = @b3_minerals
		}
		upkeep = {
			energy = @b3_upkeep
		}
	}

	prerequisites = {
		tech_basic_industry
	}	
	
	triggered_desc = {
		trigger = {
			exists = owner
			owner = { is_regular_empire = yes } 
		}
		text = job_foundry_effect_desc
	}
	
	triggered_desc = {
		trigger = { 
			exists = owner
			owner = { is_hive_empire = yes } 
		}
		text = job_alloy_drone_effect_desc
	}
	
	triggered_desc = {
		trigger = { 
			exists = owner
			owner = { is_machine_empire = yes } 
		}
		text = job_fabricator_effect_desc
	}
	
	ai_weight = {
		weight = 0
		modifier = {
			weight = 10
			free_amenities > 2
			owner = {
				has_monthly_income = {
					resource = minerals
					value > 100
				}
				has_monthly_income = {
					resource = alloys
					value < 100
				}
				has_monthly_income = {
					resource = alloys
					value > 6
				}#Check for alloy shutdown
			}
		}
		modifier = {
			factor = 0.5
			free_jobs > 3
		}
		modifier = {
			weight = 400
			NOT = { has_building = building_foundry_slave }
		}
		modifier = {
			weight = 500
			has_building = building_foundry_slave
			free_building_slots = 0
		}#Repairs
	}
}